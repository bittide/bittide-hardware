# CI hardware test server

Since the hardware-in-the-loop tests on CI depend on the Vivado Hardware
Server, the GitHub runner should not start before it. We therefore add a
systemd service which starts the Vivado Hardware Server. That service must run
before starting the GitHub runner service.

Since the "unit" file for the GitHub runner is generated by another script, we
add an additional configuration for the GitHub runner service with the
`systemd drop-in` mechanism.

## Setup
Follow these steps to setup the two services. Note that our server is called
`hoeve`, and you should change the name of your GitHub runner.

1. Generate a GitHub runner service using `scripts/register_runners.sh`
2. Create a drop-in directory for the GitHub runner service. The directory
should be named as the service with `.d` appended to it:
```
sudo mkdir -p /etc/systemd/system/actions.runner.bittide-bittide-hardware.hoeve-1.service.d
```
3. Copy the drop-in file inside the directory:
```
sudo cp vivado-hw-server.service.conf /etc/systemd/system/actions.runner.bittide-bittide-hardware.hoeve-1.service.d
```
4. Reload the systemd daemon:
```
sudo systemctl daemon-reload
```
